// Type definitions for Hap
// Definitions by: Hap <https://www.quickapp.cn/>
/**
 * WebSocketFactory
 * 接口声明: {"name": "system.websocketfactory"}
 */
export default class websocketfactory {
    /**
     * 创建websocket实例
     * @param obj
     * @property url 请求url， 必须是wss或ws协议
     * @property header 请求头，header中不能设置Referer，UserAgent设置在1040版本开始支持
     * @property protocols 子协议组
     */
    static create(obj: { url: string, header?: object, protocols?: string[] }): WebSocket
}

/**
 * WebSocket 对象提供了用于创建和管理 WebSocket 连接，以及可以通过该连接发送和接收数据的 API。
 */
export class WebSocket {
    /**
     * 向服务器发送数据
     * @param obj
     * @property data 发送的消息
     * @property success 成功回调
     * @property fail 失败回调
     */
    send(obj: { data: string | ArrayBuffer, success?: Function, fail?: Function }): void

    /**
     * 关闭当前连接
     * @param obj
     * @property code 关闭链接的状态号 ，默认1000
     * @property reason 关闭的原因
     * @property success 接口调用成功的回调函数
     * @property fail 接口调用失败的回调函数
     */
    close(obj: { code?: number, reason?: string, success?: Function, fail?: Function }): void

    /**
     * 用于指定连接成功后的回调函数
     * @param callback 打开连接回调
     */
    onopen(callback?: Function): void;

    /**
     * 用于指定连接关闭后的回调函数
     * @param callback 服务器返回消息事件回调
     */
    onmessage(callback: Function): void;

    /**
     * 用于指定连接关闭后的回调函数
     * @param callback 关闭连接事件回调
     */
    onclose(callback: Function): void;

    /**
     * 用于指定连接失败后的回调函数
     * @param callback 连接错误回调
     */
    onerror(callback: Function): void;
}